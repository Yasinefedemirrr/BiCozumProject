@model WebUI.Models.ComplaintCreateViewModel
@{
    ViewData["Title"] = "Yeni Talep Oluştur";
}

<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-plus-circle me-2"></i>Yeni Talep Oluştur
                    </h4>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post" id="complaintForm">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="Title" class="form-label">
                                    <i class="fas fa-heading me-2"></i>Talep Başlığı
                                </label>
                                <input asp-for="Title" class="form-control" placeholder="Talebinizin kısa başlığını yazınız">
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label asp-for="DepartmentId" class="form-label">
                                    <i class="fas fa-building me-2"></i>İlgili Müdürlük
                                </label>
                                <select asp-for="DepartmentId" class="form-select" id="departmentSelect">
                                    <option value="">Müdürlük seçiniz</option>
                                    @if (Model.Departments != null && Model.Departments.Any())
                                    {
                                        @foreach (var dept in Model.Departments)
                                        {
                                            <option value="@dept.Id">@dept.Name</option>
                                        }
                                    }
                                    else
                                    {
                                        <option value="" disabled>Müdürlük bilgisi yüklenemedi</option>
                                    }
                                </select>
                                <span asp-validation-for="DepartmentId" class="text-danger"></span>
                            </div>
                            
                            <div class="col-md-12 mb-3">
                                <label asp-for="Description" class="form-label">
                                    <i class="fas fa-align-left me-2"></i>Talep Açıklaması
                                </label>
                                <textarea asp-for="Description" class="form-control" rows="6" 
                                          placeholder="Talebinizi detaylı bir şekilde açıklayınız. Mümkünse adres bilgisi de ekleyiniz."></textarea>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Maksimum 1000 karakter yazabilirsiniz. <span id="charCount">0</span>/1000
                                </div>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <a href="@Url.Action("MyComplaints")" class="btn btn-secondary w-100">
                                    <i class="fas fa-list me-2"></i>Taleplerim
                                </a>
                            </div>
                            <div class="col-md-6">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-paper-plane me-2"></i>Talep Gönder
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Talep İpuçları -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-lightbulb me-2"></i>Talep Oluşturma İpuçları
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check-circle text-success me-2"></i>Yapılması Gerekenler:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-arrow-right text-primary me-2"></i>Net ve anlaşılır başlık yazın</li>
                                <li><i class="fas fa-arrow-right text-primary me-2"></i>Detaylı açıklama ekleyin</li>
                                <li><i class="fas fa-arrow-right text-primary me-2"></i>Doğru müdürlük seçin</li>
                                <li><i class="fas fa-arrow-right text-primary me-2"></i>Adres bilgisi ekleyin</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-times-circle text-danger me-2"></i>Yapılmaması Gerekenler:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-arrow-right text-warning me-2"></i>Kısa ve belirsiz açıklama</li>
                                <li><i class="fas fa-arrow-right text-warning me-2"></i>Yanlış müdürlük seçimi</li>
                                <li><i class="fas fa-arrow-right text-warning me-2"></i>Küfür ve hakaret içeren ifadeler</li>
                                <li><i class="fas fa-arrow-right text-warning me-2"></i>Kişisel bilgi paylaşımı</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Character counter
            $('#Description').on('input', function() {
                const maxLength = 1000;
                const currentLength = $(this).val().length;
                const remaining = maxLength - currentLength;
                
                $('#charCount').text(currentLength);
                
                if (currentLength > maxLength) {
                    $(this).val($(this).val().substring(0, maxLength));
                    $('#charCount').text(maxLength);
                }
                
                if (remaining < 100) {
                    $('#charCount').addClass('text-danger');
                } else {
                    $('#charCount').removeClass('text-danger');
                }
            });
            
            // Form validation
            $('#complaintForm').submit(function(e) {
                const title = $('#Title').val().trim();
                const description = $('#Description').val().trim();
                const departmentId = $('#departmentSelect').val();
                
                if (!title || !description || !departmentId) {
                    e.preventDefault();
                    Swal.fire({
                        icon: 'warning',
                        title: 'Uyarı!',
                        text: 'Lütfen tüm zorunlu alanları doldurunuz.',
                        confirmButtonColor: '#3085d6'
                    });
                    return false;
                }
                
                if (description.length < 20) {
                    e.preventDefault();
                    Swal.fire({
                        icon: 'warning',
                        title: 'Uyarı!',
                        text: 'Talep açıklaması en az 20 karakter olmalıdır.',
                        confirmButtonColor: '#3085d6'
                    });
                    return false;
                }
                
                // Show loading and allow form to submit
                Swal.fire({
                    title: 'Talep gönderiliyor...',
                    text: 'Lütfen bekleyiniz',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
                
                // Allow form to submit normally
                return true;
            });
            
            // Department change event
            $('#departmentSelect').change(function() {
                const selectedDepartment = $(this).find('option:selected').text();
                if (selectedDepartment && selectedDepartment !== "Müdürlük seçiniz") {
                    console.log('Seçilen müdürlük:', selectedDepartment);
                }
            });
        });
    </script>
} 